@import "./data/variables";
@import "./mixins";

$chatHeaderSize: 26px;

#content {
  #chat-inline-placeholder,
  #chat-fixed-placeholder {
    #chat-wrapper {
      #chat-container {
        // Make main container flexbox
        display: flex !important;
        flex-direction: column !important;

        @media (max-width: 1400px) {
          left: 0 !important;
          right: 0 !important;

          @media (max-width: 800px) {
            height: 100% !important;
          }
        }

        #chat-content {
          // Make content area flexbox
          display: flex !important;
          flex-direction: column !important;
          flex: 1 !important;
          min-height: 0 !important;

          #chat-title {
            height: $chatHeaderSize !important;
            background: $deepgray !important;
            border-radius: 8px 8px 0 0 !important;

            .l,
            .r {
              display: none !important;
            }

            .c {
              color: $gray !important;
              background: transparent !important;
              width: 120px !important;

              // Add background image when .c doesn't have a span child
              &:not(:has(span)) {
                background: transparent messageCircle-icon($gray) no-repeat 10px
                  center / 12px !important;
              }

              span {
                height: $chatHeaderSize !important;
                color: $black !important;
                background: $gray !important;
                padding: 0 !important;
                margin-left: 4px !important;
                height: $chatHeaderSize - 6px !important;
                border-radius: 5px !important;
                font: 600 1em "Montserrat", sans-serif !important;
                @include flex-layout();
              }

              // General state - $gray background with $black message circle icon
              &.general {
                span {
                  background: $gray messageCircle-icon($black) no-repeat 5px
                    center / 12px !important;
                }

                // General active state - $blue background with same message circle icon
                &.active {
                  span {
                    background: $blue messageCircle-icon($black) no-repeat 5px
                      center / 12px !important;
                  }
                }
              }

              // Game state - $gray background with game icon
              &.game {
                span {
                  background: $gray $flag-icon_black no-repeat 5px center / 12px !important;
                }

                // Game active state - $blue background with same game icon
                &.active {
                  span {
                    background: $blue $flag-icon_black no-repeat 5px center /
                      12px !important;
                  }
                }
              }
            }

            .dummy {
              background: transparent !important;
              .hide-bar {
                height: $chatHeaderSize !important;
              }
            }

            // Expand, Open... buttons
            .height-btn,
            .mostright,
            .pin {
              height: $chatHeaderSize !important;
              width: $chatHeaderSize !important;
              transition: filter 0.1s ease-out !important;

              &:hover {
                filter: brightness(1.2) !important;
              }
            }
            // Expand, Collapse button
            .height-btn {
              background: $chevronUp-icon_white no-repeat center / 16px !important;
              &.height-btn-max {
                background: $chevronDown-icon_white no-repeat center / 16px !important;
              }
            }
            // Close, Open button
            .mostright {
              background: $close-icon_white no-repeat center / 16px;
            }
            // Fixed, Floating chat button
            .pin {
              background: $anchor-icon_white no-repeat center / 16px;
            }
          }

          .chat {
            background: $deepgray !important;
            border: none !important;
            display: flex;
            flex: 1 !important;
            min-height: 0 !important;

            // Convert main chat table to flexbox
            > table {
              display: flex !important;
              width: 100% !important;
              height: 100% !important;

              tbody,
              tr {
                display: flex !important;
                width: 100% !important;
                height: 100% !important;
              }
            }

            .messages {
              background: $deepgray !important;
              display: flex !important;
              flex-direction: column !important;
              flex: 1 !important;
              min-width: 0 !important;
              overflow: hidden !important;

              .messages-border {
                background: $deepgray !important;
                border: none !important;
                display: flex !important;
                flex-direction: column !important;
                flex: 1 !important;
                min-height: 0 !important;
                overflow: hidden !important;

                .messages-content {
                  border: none !important;
                  flex: 1 !important;
                  overflow-y: auto !important;
                  padding: 5px !important;
                  scrollbar-width: thin !important;

                  .chat-header {
                    display: none !important;
                  }

                  div {
                    border: none !important;

                    p {
                      font-size: 1.2em !important;

                      @media (max-width: 1000px) {
                        white-space: break-spaces !important;

                        // Force line break after username using CSS
                        .username::after {
                          content: "\A" !important;
                          white-space: pre !important;
                        }
                      }

                      .time {
                        color: $gray;
                        visibility: hidden !important;

                        span {
                          visibility: visible !important;
                          text-decoration: none !important;

                          &:hover {
                            filter: brightness(0.8) !important;
                          }
                        }

                        // Mention message
                        &[style*="background-color: yellow"] {
                          color: $green;
                          background-color: transparent !important;
                        }
                      }

                      .username {
                        visibility: hidden !important;

                        span {
                          visibility: visible !important;
                          text-decoration: none !important;

                          &:hover {
                            filter: brightness(0.8) !important;
                          }
                        }
                      }
                    }
                  }
                }

                // Convert input table to flexbox
                > table {
                  background: $deepgray !important;
                  display: flex !important;
                  flex-shrink: 0 !important;
                  width: 100% !important;

                  tbody,
                  tr {
                    display: flex !important;
                    width: 100% !important;
                    align-items: center !important;
                  }

                  // Input field container
                  th {
                    display: flex !important;
                    flex: 1 !important;
                    padding: 0 !important;

                    form {
                      display: flex !important;
                      width: 100% !important;
                      margin: 0 !important;
                    }
                  }

                  // Send button and options
                  td {
                    display: flex !important;
                    align-items: center !important;
                    flex-shrink: 0 !important;

                    div[style*="width: 50px"][style*="height: 0px"] {
                      display: none;
                    }
                  }

                  input.text {
                    border: none !important;
                    outline: none !important;
                    background: $black !important;
                    margin: 5px !important;
                    padding: 0 10px !important;
                    height: 35px !important;
                    border-radius: 5px !important;
                    color: $white !important;
                    flex: 1 !important; // Take all available space
                    min-width: 0 !important; // Allow shrinking
                    font-size: 1.2em !important;
                  }

                  // Send button styling
                  input.send {
                    margin: 0 5px 0 0 !important;
                    padding: 0 !important;
                    flex-shrink: 0 !important;
                    height: 35px !important;
                    width: 35px !important;
                    border: none !important;
                    outline: none !important;
                    border-radius: 5px !important;
                    font-size: 0 !important;
                    transition: background 0.1s ease-out !important;
                    background: $gray $send-icon_black no-repeat center / 20px !important;

                    &:hover {
                      background: $blue $send-icon_black no-repeat center / 20px !important;
                    }
                  }

                  // Chat option buttons
                  .chat-opt-btn {
                    display: flex !important;
                    align-items: center !important;
                    justify-content: center !important;
                    flex-shrink: 0 !important;
                    height: 35px !important;
                    width: 35px !important;
                    border: none !important;
                    border-radius: 5px !important;
                    background: $gray !important;
                    margin: 0 5px 0 0 !important;
                    padding: 0 !important;
                    transition: background 0.1s ease-out !important;

                    img {
                      display: none !important;
                    }
                  }

                  .smile-btn {
                    background: $gray $smiles-panel-closed_black no-repeat
                      center / 20px !important;

                    &.active,
                    &:hover {
                      background: $blue $smiles-panel-opened_black no-repeat
                        center / 20px !important;
                    }
                  }

                  .filter-btn {
                    background: $gray $filter-icon_black no-repeat center / 20px !important;

                    &.active,
                    &:hover {
                      background: $blue $filter-icon_black no-repeat center /
                        20px !important;
                    }
                  }
                }
              }
            }

            .panel-btn {
              width: 0 !important;
              background: $gray !important;
              position: relative !important;
              padding: 0 !important;

              i {
                position: absolute !important;
                width: 35px !important;
                height: 35px !important;
                // Align the right side of the button with the scrollbar of the messages container (Especially on Firefox)
                right: calc(100% + 3px) !important;
                border-radius: 5px 0 0 5px !important;
                border: none !important;
                top: 0 !important;
                transform: translateY(0) !important;
                transition: background 0.1s ease-out !important;
                background: $blue chevronLeft-icon($black) no-repeat center /
                  20px !important;

                @media (max-width: 800px) {
                  top: 50% !important;
                  transform: translateY(-50%) !important;
                }

                &:hover {
                  background: $gray chevronLeft-icon($black) no-repeat center /
                    20px !important;
                }
              }

              &.active {
                i {
                  background: $gray chevronRight-icon($black) no-repeat center /
                    20px !important;

                  &:hover {
                    background: $blue chevronRight-icon($black) no-repeat center /
                      20px !important;
                  }
                }
              }
            }

            .userlist {
              padding: 10px !important;
              width: 200px !important;

              // Empowerment script classname
              .chat-user-list {
                scrollbar-width: thin !important;
              }

              // Original site classname
              .userlist-content {
                margin: 0 !important;
                padding: 0 !important;
                scrollbar-width: thin !important;

                ins {
                  height: 26px !important;
                  @include flex-layout(row, start, center);

                  .name {
                    height: 26px !important;
                    font-size: 1.2em !important;
                    @include flex-layout(row, start, center);
                    background-size: 24px !important;
                    padding-left: 30px !important;
                    text-decoration: none !important;
                    color: darken($white, 10%) !important;

                    &:hover {
                      filter: brightness(0.8) !important;
                    }
                  }

                  .info {
                    width: 14px !important;
                    height: 14px !important;
                    margin-left: 5px !important;
                    background: $deepgray $info-icon_lightblue no-repeat center /
                      14px !important;

                    img {
                      display: none !important;
                    }
                  }
                }
              }

              .smile-tab {
                // Make the smile tab a flex container that fills available height
                @include flex-layout(column, start, start, false);
                height: 100% !important; // Take full height of parent
                max-height: 100% !important; // Don't exceed parent height

                .smile-groups {
                  height: 35px !important;
                  width: 100% !important;
                  background: $deepgray !important;
                  @include flex-layout(row, start, center);
                  gap: 5px !important;
                  margin-bottom: 5px !important;
                  flex-shrink: 0 !important;

                  .smile-groups-action {
                    border: none !important;
                    padding: 0 !important;
                    margin: 0 !important;
                    width: 35px !important;
                    height: 35px !important;
                    color: $black !important;
                    background: $gray !important;
                    border-radius: 5px !important;
                    font: 600 1.2em "Montserrat", sans-serif !important;
                    @include flex-layout();

                    &.active {
                      background: $blue !important;
                    }
                  }
                }

                .smile-content {
                  scrollbar-width: thin !important;
                  margin: 0 !important;
                  padding: 0 !important;
                  gap: 2px !important;

                  // Calculate height: 100% minus tab height
                  height: calc(100% - 35px) !important;
                  max-height: calc(100% - 35px) !important;
                  overflow-y: auto !important;
                  overflow-x: hidden !important;
                }
              }
            }
          }
        }
      }

      // When chat is hidden, change the mostright icon
      &.chat-hidden {
        #chat-container {
          height: $chatHeaderSize !important;

          #chat-content {
            #chat-title {
              .mostright {
                background: $maximize-icon_white no-repeat center / 16px !important;
              }
            }

            .chat {
              .panel-btn {
                display: none !important;
              }
            }
          }
        }
      }
    }
  }

  // Specific styling for inline chat pin icon
  #chat-inline-placeholder {
    .handle {
      top: -15px !important;
    }

    #chat-wrapper {
      // Add bottom left/right border radius to maintain consistent rounded styling with chat title
      border-radius: 8px !important;
      overflow: hidden !important;

      #chat-container {
        // Limit chat height on floating mode
        height: 250px !important;

        #chat-content {
          #chat-title {
            .pin {
              background: $anchor-icon_lightblue no-repeat center / 16px !important;
            }
          }
        }
      }
    }
  }
}
