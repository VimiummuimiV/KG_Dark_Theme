#head {
  &.green-back {
    background: transparent !important;
  }

  .right {
    position: relative !important;
    width: 100% !important;
    padding: 0 !important;

    .menu {
      flex-direction: row-reverse !important;
      width: auto !important;
      position: fixed !important;
      top: 0 !important;
      right: 50% !important;
      transform: translateX(50%) !important;
      display: flex !important;
      justify-content: center !important;
      padding: 0 !important;
      margin: 0 !important;
      transition: all 0.2s !important;
      opacity: 0.5 !important;
      z-index: 110 !important;

      &:hover {
        opacity: 1 !important;
      }

      a:first-child {
        border-bottom-right-radius: 5px !important;
        border-right: none !important;
      }

      a:last-child {
        border-bottom-left-radius: 5px !important;
      }

      a {
        width: 110px !important;
        height: 45px !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        font: 700 11px "Montserrat", sans-serif !important;
        text-transform: uppercase !important;
        text-decoration: none !important;
        color: $black !important;
        background: $gray !important;
        border-right: 1px solid $darkgray !important;
        border-bottom: 1px solid transparent !important;
        transition: all 0.2s !important;

        &:hover,
        &.active {
          text-decoration: none !important;
          color: $black !important;
          border-right: 1px solid $darkgray !important;
          transition: all 0.2s !important;
          padding: 0 !important;
          margin: 0 !important;
          filter: brightness(1.1) !important;
        }

        &:hover:not(.active) {
          background: lighten($blue, 5%) !important;
        }

        &.active {
          background: darken($blue, 5%) !important;
        }

        &[href="/wiki/"] {
          display: none !important;
        }
      }
    }
  }
}

.bar {
  background: none !important;
}

/* Conditional positioning when userpanel exists */
.userpanel ~ #head .right .menu,
body:has(.userpanel) #head .right .menu {
  top: 45px !important;
  
  @media (max-width: 1000px) {
    top: 88px !important;
  }
}

/* Conditional positioning for hamburger button when userpanel exists */
.userpanel ~ #head .right,
body:has(.userpanel) #head .right {
  @media (max-width: 850px) {
    &:before {
      top: 88px !important;
    }
  }
}

/* Media queries that work regardless of userpanel */
#head {
  .right {
    // Initial desktop shrinking
    @media (max-width: 1200px) {
      .menu {
        a {
          width: 95px !important;
          font-size: 10px !important;
        }
      }
    }

    // Desktop adjustments for smaller screens before burger menu
    @media (max-width: 1000px) {
      .menu {
        a {
          width: 85px !important;
          height: 40px !important;
          font-size: 9px !important;
        }
      }
    }

    // Main breakpoint - switch to burger menu
    @media (max-width: 850px) {
      // Menu button (hamburger trigger)
      &:before {
        content: "" !important;
        width: 50px !important;
        height: 50px !important;
        position: fixed !important;
        top: 0 !important;
        right: 5px !important;
        color: $blue !important;
        cursor: pointer !important;
        z-index: 10000 !important;
        border-radius: 0 0 5px 5px !important;
        background: $black icon("menu", $lightblue) no-repeat center / 20px !important;
      }

      .menu {
        transform: translateX(0) !important;
        opacity: 0 !important;
        visibility: hidden !important;
        transition: opacity 0.3s ease !important;
        position: fixed !important;
        z-index: 9999 !important;
        background: $black !important;
        backdrop-filter: blur(10px) !important;
        border-radius: 8px !important;
        padding: 5px !important;
        right: 0 !important;
        left: 0 !important;
        top: 0 !important;
        max-width: 100% !important;
        flex-wrap: wrap !important;
        gap: 5px !important;

        a {
          flex: 1 1 auto !important;
          min-width: 0 !important;
          height: 40px !important;
          font-size: 9px !important;
          border-right: none !important;
          border-radius: 5px !important;
        }
      }

      // Show menu on hover
      &:hover .menu {
        opacity: 1 !important;
        visibility: visible !important;
        pointer-events: auto !important;
      }

      // Hide menu button when menu is visible
      &:hover:before {
        opacity: 0 !important;
        visibility: hidden !important;
      }

      // Keep hamburger button visible when login block is hovered (since menu is hidden)
      &:hover .login-block:hover ~ .menu {
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
      }
    }

    // Small mobile - more compact dropdown
    @media (max-width: 400px) {
      .menu {
        flex-direction: column !important;
        padding: 10px !important;
        gap: 10px !important;

        a {
          width: 100% !important;
        }
      }
    }
  }
}